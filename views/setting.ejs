<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Set Raspberry Pi Static IP</title>
</head>
<body>
    <h1>Set Raspberry Pi Static IP</h1>
    <form method="post">
        <label for="ip">IP Address:</label>
        <input type="text" id="ip" name="ip" value="<%= ip %>" required><br>
        <label for="netmask">Netmask:</label>
        <input type="text" id="netmask" name="netmask" value="<%= netmask %>" required><br>
        <label for="gateway">Gateway:</label>
        <input type="text" id="gateway" name="gateway" value="<%= gateway %>" required><br>
        <button type="button" id="setIP">Set IP</button>
    </form>
    <script>
        var ip = document.getElementById('ip');
        var netmask = document.getElementById('netmask');
        var gateway = document.getElementById('gateway');
        ip.addEventListener('input', function() {
            if (!ip.value.match(/^(\d{1,3}\.){3}\d{1,3}$/)) {
                ip.setCustomValidity('Invalid IP address');
            } else {
                ip.setCustomValidity('');
            }
        });
        netmask.addEventListener('input', function() {
            if (!netmask.value.match(/^(\d{1,3}\.){3}\d{1,3}$/)) {
                netmask.setCustomValidity('Invalid netmask');
            } else {
                netmask.setCustomValidity('');
            }
        });
        gateway.addEventListener('input', function() {
            if (!gateway.value.match(/^(\d{1,3}\.){3}\d{1,3}$/)) {
                gateway.setCustomValidity('Invalid gateway');
            } else {
                gateway.setCustomValidity('');
            }
        });

        document.getElementById('setIP').addEventListener('click', function() {
            if (ip.checkValidity() && netmask.checkValidity() && gateway.checkValidity()) {
                console.log('Setting IP address');
                console.log(ip.value);
                console.log(netmask.value);
                console.log(gateway.value);
                fetch('/set-ip', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ip: ip.value,
                        netmask: netmask.value,
                        gateway: gateway.value
                    })
                }).then(function(response) {
                    if (response.ok) {
                        alert('IP address set successfully');
                    } else {
                        alert('Failed to set IP address');
                    }
                });
            }
        });
    </script>
</body>
</html>
